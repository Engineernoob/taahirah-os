<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Booting...</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      body {
        margin: 0;
        background: #000080; /* Win98 dark blue */
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        height: 100vh;
        color: white;
        font-family: "W95", "MS Sans Serif", sans-serif;
        overflow: hidden;
      }

      .boot-logo {
        display: none;
        flex-direction: column;
        align-items: center;
        opacity: 0;
        animation: fadeIn 1s ease forwards;
      }

      .boot-logo img {
        width: 320px;
        image-rendering: pixelated;
        margin-bottom: 16px;
      }

      .boot-logo p {
        font-size: 14px;
        margin: 8px 0;
      }

      .boot-progress {
        width: 300px;
        height: 18px;
        border: 2px inset #fff;
        background: #000;
        margin-top: 18px;
        padding: 2px;
        display: none; /* hidden until boot starts */
      }

      .boot-progress .progress-bar {
        width: 0%;
        height: 100%;
        background: #00ff00;
        transition: width 0.2s linear;
      }

      @keyframes boot-progress {
        from {
          width: 0%;
        }
        to {
          width: 100%;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Overlay */
      #boot-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: black;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 999;
        color: white;
        font-size: 18px;
        cursor: pointer;
        user-select: none;
        animation: flicker 1.5s infinite alternate;
      }

      @keyframes flicker {
        from {
          opacity: 0.6;
        }
        to {
          opacity: 1;
        }
      }

      #boot-overlay p {
        margin: 0;
        font-family: "MS Sans Serif", sans-serif;
      }
    </style>
  </head>

  <body>
    <!-- Overlay -->
    <div id="boot-overlay">
      <p>â–¶ Click to Start TaahirahOS</p>
    </div>

    <div class="boot-logo">
      <img src="icons/win-98-logo.png" alt="Windows 98" />
      <p>Starting <b>TaahirahOS</b>...</p>
      <div class="boot-progress">
        <div class="progress-bar"></div>
      </div>
    </div>

    <!-- Boot sound -->
    <audio id="boot-sound" preload="auto">
      <source src="sounds/winxp.mp3" type="audio/mpeg" />
      <source src="sounds/win-start.ogg" type="audio/ogg" />
    </audio>

    <script>
      const overlay = document.getElementById("boot-overlay");
      const bootLogo = document.querySelector(".boot-logo");
      const bootSound = document.getElementById("boot-sound");
      const progressBar = document.querySelector(".progress-bar");
      const progressContainer = document.querySelector(".boot-progress");

      let hasStarted = false;

      overlay.addEventListener("click", async () => {
        if (hasStarted) return;
        hasStarted = true;

        overlay.style.display = "none"; // remove overlay
        bootLogo.style.display = "flex"; // show boot screen
        progressContainer.style.display = "block"; // show progress bar

        // Start progress animation
        progressBar.style.animation = "boot-progress 3.2s linear forwards";

        // Play boot sound and redirect after it ends
        try {
          bootSound.volume = 0.7;
          await bootSound.play();

          bootSound.addEventListener("ended", () => {
            window.location.replace("index.html");
          });
        } catch (err) {
          console.warn("Boot sound autoplay blocked:", err);
          // Fallback timer in case of autoplay restrictions
          setTimeout(() => {
            // Mark the system as fully booted
            sessionStorage.setItem("booted", "true");
            sessionStorage.removeItem("restarting"); // Clear restart flag if set
            window.location.replace("index.html");
          }, 3500);
        }
      });
    </script>
  </body>
</html>
